# Performance Reports Sync (iOS + Web)

This implementation adds real-data weekly, monthly, and yearly performance reports that are shared by iOS and web.

## What was added

- Supabase migration: `supabase/migrations/20260224000000_create_performance_reports.sql`
- New `public.reports` table (includes `llm_summary`, `recommendations`, `metrics`, `deltas`)
- New RPCs:
  - `public.generate_member_performance_report(...)`
  - `public.generate_my_performance_reports(...)`
- iOS now calls report generation RPC before reading reports
- Web Stats now reads the same `reports` rows and renders weekly/monthly/yearly cards

## Real data sources

Reports are computed from live rows, not hardcoded values:

- `sessions`
  - `doors_knocked` from `completed_count`
  - `flyers_delivered` from `flyers_delivered` (fallback to `completed_count`)
  - `conversations` from `conversations`
  - `distance_walked` from `distance_meters` (converted to km)
  - `time_spent_seconds` from session duration (or `active_seconds` when active)
  - `sessions_count` from number of sessions in period
- `contacts`
  - `leads_created` from contacts created in period
- `crm_events`
  - `appointments_set` from rows with `fub_appointment_id` in period

## Conversion metrics included

Each report includes:

- `conversation_to_lead_rate`
- `conversation_to_appointment_rate`

Both are computed from the same period's real counts.

## Period comparison behavior

- Weekly report compares against previous week
- Monthly report compares against previous month
- Yearly report compares against previous year

Each metric includes delta object:

- `abs`: absolute change
- `pct`: percent change
- `trend`: `up` | `down` | `flat`

## Deploy steps

1. Run Supabase migrations so the new schema/RPC exists.
2. Release iOS build with updated report generation call.
3. Deploy web build so Stats page reads and shows report cards.

## How iOS and web stay in sync

Both clients use the same backend contract:

1. Call `generate_my_performance_reports` (best effort, idempotent refresh)
2. Read latest rows from `public.reports` by period (`weekly`, `monthly`, `yearly`)

Because both read the same table generated by the same SQL logic, values and comparisons match across platforms.
